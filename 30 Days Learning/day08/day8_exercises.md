# Day 8 Exercises: Kubebuilder Structure Analysis

*Time: 15 minutes | Focus: Understanding ODH's Kubebuilder setup*

## Exercise 1: Explore ODH's Kubebuilder Project Structure (5 minutes)

Navigate to the ODH operator codebase and examine its Kubebuilder-generated structure:

```bash
cd /Users/suksubra/Documents/Work/RHOAI/opendatahub-operator

# 1. Examine the PROJECT file (Kubebuilder metadata)
cat PROJECT

# 2. Look at the overall project structure
ls -la

# 3. Examine the main.go file structure
head -50 main.go

# 4. Check the Makefile (Kubebuilder-generated targets)
grep -E "^[a-zA-Z][^=]*:" Makefile | head -10
```

### What to Notice:
- **PROJECT file**: Contains Kubebuilder version, domain, and resource definitions
- **Standard structure**: apis/, controllers/, config/ directories
- **main.go**: Manager setup following Kubebuilder patterns
- **Makefile**: Standard Kubebuilder targets (generate, manifests, test, run, etc.)

## Exercise 2: Analyze ODH API Types and Markers (5 minutes)

Examine how ODH defines its APIs using Kubebuilder conventions:

```bash
# 1. Look at the DataScienceCluster API definition
ls apis/datasciencecluster/v1/
cat apis/datasciencecluster/v1/datasciencecluster_types.go | head -50

# 2. Find Kubebuilder markers in the file
grep -n "+kubebuilder" apis/datasciencecluster/v1/datasciencecluster_types.go

# 3. Examine the DSCInitialization API as well
ls apis/dscinitialization/v1/
grep -n "+kubebuilder" apis/dscinitialization/v1/dscinitialization_types.go | head -10
```

### What to Look For:
- **Struct tags**: `json` and `yaml` tags for serialization
- **Kubebuilder markers**: Lines starting with `//+kubebuilder:`
- **API structure**: TypeMeta, ObjectMeta, Spec, Status pattern
- **Validation markers**: Pattern, Optional, Required, etc.

## Exercise 3: Examine Controller Setup (3 minutes)

Look at how ODH controllers are structured and registered:

```bash
# 1. List the controllers
ls controllers/

# 2. Look at controller registration in main.go
grep -A 10 -B 5 "SetupWithManager" main.go

# 3. Examine a controller structure
head -30 controllers/datasciencecluster/datasciencecluster_controller.go

# 4. Find the Reconcile method signature
grep -A 5 "func.*Reconcile" controllers/datasciencecluster/datasciencecluster_controller.go
```

### Key Observations:
- **Controller struct**: Contains Client, Scheme, and other dependencies
- **SetupWithManager**: Kubebuilder pattern for controller registration
- **Reconcile method**: Standard signature `(context.Context, ctrl.Request) (ctrl.Result, error)`
- **RBAC markers**: Comments that generate RBAC permissions

## Exercise 4: Explore Generated Manifests (2 minutes)

Check what Kubebuilder generates for ODH:

```bash
# 1. Look at the config directory structure
find config -type f -name "*.yaml" | head -10

# 2. Examine a generated CRD
ls config/crd/bases/
head -20 config/crd/bases/datasciencecluster.opendatahub.io_datascienceclusters.yaml

# 3. Check RBAC generation
ls config/rbac/
cat config/rbac/role.yaml | head -20

# 4. Look at sample custom resources
ls config/samples/
cat config/samples/datasciencecluster_v1_datasciencecluster.yaml
```

### Understanding the Generation:
- **CRDs**: Generated from Go struct definitions and markers
- **RBAC**: Generated from `//+kubebuilder:rbac` markers in controllers
- **Samples**: Example custom resources for testing
- **Manager**: Deployment manifests for the operator

## Reflection Questions

After completing these exercises, consider:

1. **Project Structure**: How does ODH's structure compare to the standard Kubebuilder layout you learned about?

2. **Markers Usage**: What types of Kubebuilder markers does ODH use most frequently?

3. **Generated vs Custom**: Which parts of ODH are generated by Kubebuilder and which are custom implementations?

4. **Controller Pattern**: How does ODH's controller setup follow Kubebuilder conventions?

5. **API Design**: How do ODH's API types (DataScienceCluster, DSCInitialization) use Kubebuilder patterns?

## Quick Reference Commands

```bash
# Essential ODH + Kubebuilder commands
cd /Users/suksubra/Documents/Work/RHOAI/opendatahub-operator

# View project metadata
cat PROJECT

# See all Kubebuilder markers
find . -name "*.go" -exec grep -l "+kubebuilder" {} \;

# Check generated manifests
ls config/crd/bases/
ls config/rbac/

# View controller structure
find controllers -name "*_controller.go"
```

## Next Steps

These exercises prepared you for Day 9 by:
- Understanding ODH's Kubebuilder project structure
- Seeing markers in action within real code
- Observing the relationship between Go code and generated manifests
- Getting familiar with standard Kubebuilder patterns

Tomorrow you'll dive deep into the marker system and learn how to use markers effectively for code generation!